<div class="flex justify-center px-4 sm:px-6 md:px-8 mt-6">
  <div class="w-full max-w-5xl space-y-4 p-6 bg-white backdrop-blur-md rounded-lg shadow-lg mb-4">

    <%= search_form_for q, url: reviews_path, method: :get, class: "mb-6", local: true do |f| %>
      <div class="space-y-4">
        <!-- 香水名・ブランド名検索（上段） -->
        <div class="form-control">
          <%= f.label :fragrance_name_or_fragrance_brand_cont, "香水名・ブランド名", class: "label font-semibold text-gray-700" %>

          <div class="flex gap-2">
            <!-- オートコンプリート全体のコンテナ -->
            <div class="flex-1 relative"
                  data-controller="auto-complete"
                  data-auto-complete-url-value="<%= autocomplete_reviews_path %>">

              <!-- 入力フィールド -->
              <%= f.search_field :fragrance_name_or_fragrance_brand_cont,
                class: "input input-bordered w-full",
                placeholder: "例：シャネル",
                data: {
                  auto_complete_target: "input",
                  action: "input->auto-complete#handleInput focus->auto-complete#handleInput keydown->auto-complete#handleKeydown"
                } %>

              <!-- オートコンプリート結果表示（入力フィールドの真下） -->
              <div data-auto-complete-target="results"
                    class="bg-white border border-gray-300 rounded-lg shadow-lg z-50 max-h-60 overflow-y-auto hidden mt-1">
              </div>
            </div>

            <!-- 検索ボタン -->
            <button type="submit" class="btn btn-primary">
              <i class="fas fa-search mr-1"></i>
              検索
            </button>
          </div>
        </div>

        <!--（下段） -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <!-- タグ検索 -->
          <div class="form-control">
            <%= f.label :fragrance_tags_id_eq, "香りのカテゴリ", class: "label font-semibold text-gray-700" %>
            <%= f.collection_select :fragrance_tags_id_eq,
              Tag.all, :id, :name,
                { prompt: "カテゴリを選択" },
                { class: "select select-bordered w-full bg-white" } %>
          </div>
        </div>
      </div>
    <% end %>

    <!-- 検索状態の表示 -->
    <% if params[:q].present? %>
      <div class="bg-base-200 p-4 rounded-lg mb-4">
        <div class="flex flex-col sm:flex-row sm:justify-between sm:items-start gap-3">
          <!-- 検索結果の件数 -->
          <div class="flex items-center gap-2">
            <i class="fa-solid fa-search text-primary"></i>
            <span class="font-semibold">
              検索結果: <span class="text-primary text-lg"><%= @reviews.total_count %></span>件
            </span>
          </div>

          <!-- 検索条件をバッジで表示 -->
          <div class="flex flex-wrap gap-2">
            <!-- 香水名・ブランド名 -->
            <% if params[:q][:fragrance_name_or_fragrance_brand_cont].present? %>
              <div class="badge badge-primary gap-1">
                <i class="fas fa-tag"></i>
                キーワード: <%= params[:q][:fragrance_name_or_fragrance_brand_cont] %>
              </div>
            <% end %>

            <!-- タグ検索 -->
            <% if params[:q][:fragrance_tags_id_eq].present? %>
              <div class="badge badge-secondary gap-1">
                <i class="fas fa-bookmark"></i>
                <%= Tag.find(params[:q][:fragrance_tags_id_eq]).name %>
              </div>
            <% end %>

            <!-- クリアボタン -->
            <%= link_to reviews_path, class: "btn btn-outline btn-sm" do %>
              <i class="fas fa-times"></i>
              検索条件をクリア
            <% end %>
          </div>
        </div>
      </div>
    <% end %>
  </div>
</div>