<% content_for(:title, t('.title')) %>

<h1 class="text-3xl font-bold mb-6 text-center">
  <i class="fa-solid fa-magnifying-glass-plus"></i> <%= t('.title') %>
</h1>

<div class="max-w-xl mx-auto bg-white p-6 rounded-xl shadow-lg"
      data-controller="step-form">

  <!-- プログレスインジケーター -->
  <div class="mb-6 text-center">
    <span class="progress-indicator text-lg font-semibold text-indigo-600"></span>
  </div>

  <%= form_with url: diagnosis_path, method: :post do %>

    <% @questions.each_with_index do |(key, data), index| %>
      <div class="step" data-step-form-target="step" style="display: none;">
        <fieldset class="mb-6">
          <legend class="mb-4 text-xl font-semibold text-gray-700 text-center">
            <%= data[:question] %>
          </legend>
          <div class="space-y-3">
            <% data[:options].each do |option_key, option_data| %>
              <label class="flex items-center space-x-3 cursor-pointer hover:bg-gray-100 rounded px-3 py-2">
                <%= radio_button_tag "answers[#{key}]", option_key,
                    (@selected_answers && @selected_answers[key.to_s] == option_key), 
                    class: "form-radio text-indigo-600",
                    data: { action: "change->step-form#checkAnswer" } %>
                <span class="text-gray-800"><%= option_data[:text] %></span>
              </label>
            <% end %>
          </div>
        </fieldset>

        <!-- ナビゲーションボタン -->
        <div class="flex justify-between items-center mt-6">
          <% if index > 0 %>
            <button type="button"
                    data-action="click->step-form#previous"
                    class="btn btn-outline">
              前へ
            </button>
          <% else %>
            <div></div>
          <% end %>

          <% if index < @questions.length - 1 %>
            <button type="button"
                    data-action="click->step-form#next"
                    data-step-form-target="nextButton"
                    class="btn btn-disabled opacity-70 cursor-not-allowed"
                    disabled>
              次へ
            </button>
          <% else %>
            <%= submit_tag t('.submit'),
                class: "btn btn-disabled opacity-70 cursor-not-allowed",
                data: { step_form_target: "nextButton" },
                disabled: true %>
          <% end %>
        </div>
      </div>
    <% end %>

  <% end %>
</div>