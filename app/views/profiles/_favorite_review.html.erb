<div class="bg-white from-pink-50 to-purple-50 backdrop-blur-m p-4 rounded-xl shadow-lg flex flex-col relative">
  <!-- お気に入り追加日を表示 -->
  <div class="absolute top-2 right-2 bg-base text-base-content text-xs px-2 py-1 rounded-full">
    <i class="fa-solid fa-star mr-1"></i>
    <%= time_ago_in_words(current_user.favorites.find_by(review: review).created_at) %>前
  </div>

  <% fragrance = review.fragrance %>
  <!-- ボトル画像 -->
  <div class="h-48 flex items-center justify-center rounded-md overflow-hidden">
    <%= link_to review_path(review), data: { action: "click->loading#show" } do %>
      <div class="object-cover w-full h-[160px] cursor-pointer transition hover:opacity-80">
        <% if fragrance.image.attached? %>
          <%= image_tag fragrance.image.variant(resize_to_limit: [400, 300]), class: "w-full h-full object-cover rounded-xl shadow" %>
        <% else %>
          <%= image_tag "default_fragrance.png", class: "w-full h-full object-cover rounded-xl shadow" %>
        <% end %>
      </div>
    <% end %>
  </div>

  <!-- ブランド名・香水名 -->
  <div class="flex flex-grow flex-col px-3 mt-4">
    <p class="text-sm text-gray-600 font-semibold"><%= fragrance.brand %></p>
    <p class="text-lg font-bold text-gray-800"><%= fragrance.name %></p>

    <!-- タグ -->
    <div class="mt-2 mb-3">
      <%= display_tags(review.fragrance) %>
    </div>
  </div>

  <!-- レビュー内容 -->
  <p class="line-clamp-2 text-sm text-gray-700 mb-3">
    <%= simple_format(truncate(review.body, length: 80, omission: '…')) %>
  </p>

  <!-- ユーザー情報 -->
  <div class="flex items-center justify-between text-sm text-gray-600">
    <div class="flex items-center">
      <div class="avatar mr-2">
        <div class="w-6 rounded-full">
          <% if review.user.profile_image.attached? %>
            <%= image_tag review.user.profile_image, alt: review.user.name %>
          <% else %>
            <div class="bg-neutral text-neutral-content rounded-full w-6 h-6 flex items-center justify-center">
              <i class="fa-solid fa-user text-xs"></i>
            </div>
          <% end %>
        </div>
      </div>
      <span><%= review.user.name.presence || "匿名" %></span>
    </div>

    <!-- お気に入りボタン（解除ボタンとして機能） -->
    <div class="flex items-center space-x-2">
      <%= render 'shared/favorite_button', review: review %>
    </div>
  </div>
</div>